<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
        
<mapper namespace="com.example.mapper.NoticeTestMapper">
		
	<select id="selectBoardCount"
	parameterType="hashmap"
	resultType="int">
		select count(*) from tb_notice
		where 1=1
		<if test='type != null and type !=""'>
		<![CDATA[
					and type = '${type}'
					]]>
					</if>
		<if test='title != null and title !=""'>
		<![CDATA[
					and title like '%${title}%'
					]]>
					</if>
		<choose>
					
				<when test='validType != null and validType !="" and validType=="0"'>
				<![CDATA[
		 		and (SYSDATE BETWEEN START_DT AND END_DT)
		 		]]>
				</when>
				<when test='validType != null and validType !="" and validType=="1"'>
				<![CDATA[
				and (NOT(sysdate BETWEEN START_DT AND END_DT))
		 		]]>
			</when>
				
		</choose>
		<if test='reg_user != null and reg_user !=""'>
		<![CDATA[
					and reg_user like'%${reg_user}%'
					]]>
					</if>
					and status='Y'
	</select>
	
	
	
	<select id="noticeSelectList" parameterType="HashMap" resultType="com.example.dto.NTSelectListVO">
	
		<![CDATA[

			
			SELECT
				ROW_NUMBER() over(ORDER BY idx desc) AS row_num
				,idx
				,type
				,title
				,TO_CHAR(TO_DATE(start_dt , 'YYYYMMDD'), 'YYYY-MM-DD') as startDt
				,TO_CHAR(TO_DATE(end_dt , 'YYYYMMDD'), 'YYYY-MM-DD')  as endDt
				,reg_user as regUser
				,TO_CHAR(TO_DATE(reg_dt, 'YYYYMMDD'),'YYYY-MM-DD')  AS regDt
				,TO_CHAR(TO_DATE(reg_tm, 'HH24MISS'),'HH24:MM:DD')  AS regTm
				
			FROM TB_NOTICE
				]]>
				where 1=1
				<if test='type != null and type !=""'>
					<![CDATA[
					and type = #{type}
					]]>
				</if>
				<if test='title != null and title !=""'>
					<![CDATA[
					and title like '%${title}%'
					]]>
				</if>
				<choose>
					<when test='validType != null and validType !="" and validType.equals("0")'>
					<![CDATA[
			 		and (SYSDATE BETWEEN START_DT AND END_DT)
			 		]]>
					</when>
					<when test='validType != null and validType !="" and validType.equals("1")'>
					<![CDATA[
					and (NOT(sysdate BETWEEN START_DT AND END_DT))
			 		]]>
					</when>	
				</choose>
				<if test='reg_user != null and reg_user !=""'>
					<![CDATA[
					and reg_user like '%${reg_user}%'
					]]>
				</if>
				 <if test="firstRecordIndex !=null and lastRecordIndex != null">
            	and (row_num BETWEEN #{firstRecordIndex} AND  #{lastRecordIndex})
        		</if>
				and status='Y'
			    ORDER BY IDX DESC
	</select>
	
	<select id="noticeSelectOne" resultType="com.example.dto.NTSelectOneVO">
		
		SELECT
				idx
				,type
				,title
				,contents 
				,TO_CHAR(TO_DATE(start_dt , 'YYYYMMDD'), 'YYYY-MM-DD') as startDt
				,TO_CHAR(TO_DATE(end_dt , 'YYYYMMDD'), 'YYYY-MM-DD')  as endDt
				,reg_user 
				,reg_dt 
				,reg_tm 
			FROM 
			TB_NOTICE 
			where 1=1	
			AND idx = #{idx}
			ORDER BY IDX DESC
			
	</select>	
	
	<insert id="insertOne" parameterType="com.example.dto.NTInsertVO">
    <![CDATA[
    	INSERT INTO tb_notice(
			 idx
			 ,title
			,contents  
			,status
			,type
			,start_dt 
			,start_tm 
			,end_dt 
			,reg_user 
			,end_tm 
			,reg_dt
			,reg_tm 
		)VALUES
		(
			TB_NOTICE_SEQ.NEXTVAL
			,#{title}
			,#{contents}
			,'Y'
			,#{type}
			,#{start_dt}
			,'000000'
			,#{end_dt}
			,#{reg_user}
			,'000000'
			,TO_CHAR(SYSDATE, 'YYYYMMDD')
			,TO_CHAR(SYSDATE, 'HH24MISS')
		)
		 ]]>
    </insert>
	
	<update id="updateOne" parameterType="com.example.dto.NTUpdateVO">
    <![CDATA[
    	UPDATE 
    		tb_notice
    	SET
    		 title =  #{title}
			,contents = #{contents}
    		,type = #{type}
			,start_dt = #{start_dt}
			,end_dt = #{end_dt}
    		,udt_dt = TO_CHAR(SYSDATE, 'YYYYMMDD')
			,udt_tm = TO_CHAR(SYSDATE, 'HH24MISS')		
    	where 1=1
    	and idx = #{idx}
    ]]>
    </update>
	
	<update id="deleteOne" parameterType="com.example.dto.NTDeleteVO">
    <![CDATA[
    	UPDATE 
    		tb_notice
    	SET
    		STATUS = 'N'
    		,udt_dt = TO_CHAR(SYSDATE, 'YYYYMMDD')
			,udt_tm = TO_CHAR(SYSDATE, 'HH24MISS')	
    	WHERE 1=1
    	AND IDX = ${idx}
    	
    ]]>
    </update>
</mapper>